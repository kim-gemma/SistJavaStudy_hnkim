<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>My Car Detail</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<style>
    body {
        background-color: #f8f9fa;
    }
    .car-card {
        max-width: 700px;
        margin: 50px auto;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        padding: 30px;
        background: white;
    }
    .car-image {
        width: 100%;
        border-radius: 12px;
        margin-bottom: 20px;
    }
    .info-label {
        font-weight: bold;
        margin-right: 10px;
    }
    .button-area {
        margin-top: 30px;
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    /* ëŒ“ê¸€ ì˜ì—­ */
    #commentList {
        background-color: #f1f3f5;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
    }

    .comment-item {
        background: white;
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
</style>
</head>

<body>

<div class="car-card">

    <h2 class="text-center mb-4">[[${dto.carname}]]</h2>

    <img th:src="@{|/carsave/${dto.carphoto}|}" class="car-image">

    <h5>
        <span class="info-label">ìƒ‰ìƒ:</span>
        <span th:text="${dto.carcolor}"
              th:style="'background-color:' + ${dto.carcolor} 
                       + '; padding:6px 15px; border-radius:20px; color:white;'">
        </span>
    </h5>

    <h5>
        <span class="info-label">ê°€ê²©:</span>
        [[${#numbers.formatInteger(dto.carprice, 3, 'COMMA')}]] ì›
    </h5>

    <h5>
        <span class="info-label">êµ¬ì…ì¼:</span>
        [[${dto.carquip}]]
    </h5>

    <h5>
        <span class="info-label">ë“±ë¡ë‚ ì§œ:</span>
        <span th:text="${#calendars.format(dto.writeday, 'yyyy-MM-dd HH:mm')}"></span>
    </h5>

    <hr class="my-4">

    <!-- ëŒ“ê¸€ ì˜ì—­ -->
    <h4><i class="bi bi-chat-dots"></i> ëŒ“ê¸€</h4>

    <input type="hidden" id="num" th:value="${dto.num}">

    <div class="input-group mb-3">
        <input type="text" id="comment" class="form-control"
               placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”">
        <button class="btn btn-primary" type="button" id="btnComment">
            ë“±ë¡
        </button>
    </div>

    <div id="commentList"></div>

    <!-- ë²„íŠ¼ ì˜ì—­ -->
    <div class="button-area">
        <button type="button" class="btn btn-secondary"
                onclick="location.href='/list'">ëª©ë¡</button>

        <button type="button" class="btn btn-success"
                onclick="location.href='/addcar'">ê¸€ì“°ê¸°</button>

        <button type="button" class="btn btn-warning"
                th:onclick="|location.href='@{/updateform(num=${dto.num})}'|">
            ìˆ˜ì •
        </button>

        <button type="button" class="btn btn-danger"
                th:onclick="|location.href='@{/delete(num=${dto.num})}'|">
            ì‚­ì œ
        </button>
    </div>

</div>


<script>
$(function(){

    var num = $("#num").val();

    // ğŸ”¹ í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ“ê¸€ ìë™ ë¡œë”©
    loadComments();

    function loadComments(){
        $.ajax({
            type: "get",
            dataType:"json",
            url: "commentlist",
            data: {"num": num},
            success: function(list){

                var s = "";

                if(list.length == 0){
                    s = "<div class='text-muted'>ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>";
                } else {

                    $.each(list, function(i, c){

                        s += `
                        <div class="comment-item d-flex justify-content-between align-items-center">
                            <div>
                                <div>${c.content}</div>
                                <small class="text-muted">${c.writeday.replace('T',' ')}</small>
                            </div>
                            <button class="btn btn-sm btn-danger delbtn" data-id="${c.id}">
                                ì‚­ì œ
                            </button>
                        </div>
                        `;
                    });
                }

                $("#commentList").html(s);
            }
        });
    }

    // ğŸ”¹ ëŒ“ê¸€ ë“±ë¡
    $("#btnComment").click(function(){

        var comment = $("#comment").val();

        if(comment.trim() == ""){
            alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”");
            return;
        }

        $.ajax({
            type: "post",
            url: "/addcomment",
            data: {num: num, comment: comment},
            success: function(){
                $("#comment").val("");
                loadComments();
            }
        });
    });

    

});
</script>

</body>
</html>